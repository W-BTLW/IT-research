# 자바스크립트와 멀티스레드

> 자바스크립트 언어 자체는 싱글 스레드지만,
> 
> 
> 브라우저나 Node.js는 **멀티스레드 환경 위에서 비동기 처리를 지원**한다.
> 

## 스레드(thread)란?

- 프로그램 안에서 작업을 실행하는 최소 단위
- JS에서의 스레드
    - 자바스크립트 코드(`.js`)는 자바스크립트 엔진(V8, Chakra 등)에서 실행됨
    - 해당 엔진은 ***단 하나의 메인 스레드*** 에서만 사용 → 코드가 순서대로 한 줄씩 실행
    - 이때 이 코드를 실행하는 흐름이 스레드(thread) → 즉 **자바스크립트는 싱글 스레드 언어**

```jsx
console.log(1);
console.log(2);
console.log(3);

/* CPU는 1 -> 2 -> 3 순서대로 실행*/
```

## 자바스크립트는 왜 싱글 스레드인가?
- JS 코드는 하나의 메인 스레드(Main Thread)에서 실행됨

⇒ 한 번에 한 줄씩 순차적으로 실행

- 여러 스레드가 동시에 DOM을 수정하면 충돌 또는 일관성 문제 생길 가능성 有
- 따라서 단일 스레드로 안전하게 동작하도록 설계됨

## 자바스크립트는 왜 멀티 스레드처럼 보일까?

⇒ 실행 환경(브라우저, Node.js)이 **멀티스레드 백엔드** 를 제공

1. 비동기 처리
- 브라우저나 Node.js는 백그라운드 스레드를 활용해 메인 스레드가 다른 일을 하는 동한 다른 작업을 동시에 처리할 수 있음

```jsx
console.log("A");

setTimeout(() => {
  console.log("B");
}, 1000);

console.log("C");

/* 
출력결과
A
C
B
*/
```

- 비동기 함수들

| 비동기 작업 종류 | 실제 담당 스레드/시스템 |
| --- | --- |
| `setTimeout`, `setInterval` | 타이머 스레드 |
| `fetch`, `XMLHttpRequest` | 네트워크 스레드 |
| `addEventListener` (클릭 등) | 이벤트 감지 스레드 |
| 파일 I/O (Node.js) | libuv 스레드 풀 |
| 암호화, 압축, DNS 등 | libuv 스레드 풀 |
- 자바스크립트 코드 자체는 이들을 직접 제어하지 않지만, 이들 스레드가 백그라운드에서 일하고 결과를 이벤트 루프를 통해메인 스레드로 보내는 구조

1. 이벤트 루프
- 메인 스레드(JS 실행 스레드)와 백그라운드 스레드(비동기 작업 처리 스레드 사이를 중재하고 조율하는 시스템
- 이걸 끊임없이 반복(check)하는 루프 구조라서 이벤트 루프라 부름

```jsx
┌──────────────────────────────┐
│  ① Call Stack (호출 스택)     │ ← JS 코드 실행 (싱글 스레드)
└──────────┬───────────────────┘
           │
           ▼
┌──────────────────────────────┐
│  ② Web APIs (백그라운드)     │ ← 타이머, fetch, 이벤트 감지 등
└──────────┬───────────────────┘
           │
           ▼
┌──────────────────────────────┐
│  ③ Callback Queue (콜백 큐)   │ ← 완료된 작업 콜백 대기
└──────────┬───────────────────┘
           │
           ▼
     🌀  Event Loop  🌀
        ↓ 반복 확인 ↓

```

| 역할 | 설명 |
| --- | --- |
| **① 스택 감시** | 메인 스레드(Call Stack)가 비었는지 계속 확인 |
| **② 큐 감시** | 백그라운드(Web API)에서 완료된 콜백이 Callback Queue에 있는지 확인 |
| **③ 전달 및 실행** | 스택이 비면 큐에서 콜백을 하나 꺼내 실행 (즉, JS 코드로 복귀) |