# 대용량 트래픽 제어와 분산 ID 생성 전략
우리가 매일 사용하는 금융 서비스, 거래 시스템, 또는 인기 쇼핑몰이나 티켓팅까지 아주 다양한 서비스들이 고객요청을 동시에 처리함.
순간적으로 요청이 몰리면 시스템은 과부화되어 마비될 수 있으며, 이는 곧 서비스의 신뢰도 하락으로 이어짐.
<br>
이 대용량 트래픽을 안전하게 제어하는 기술과 모든 요청에 '세상에 단 하나뿐인 고유한 번호(ID)'를 부여하는 백엔드 기술에 대해 알아보겠다.

<br><br>

## 1. 서비스 안정성의 핵심 : 대용량 트래픽 제어
트래픽 제어는 시스템이 감당할 수 있는 수준으로 요청을 조절하여 시스템 과부하를 방지하고 안정성을 유지하는 핵심 DevOps/Backend 기술이다.
<br>

#### 1.1 Rate Limiting(처리률 제한) - 시스템의 방화벽
Rate Limiting은 서버나 API 게이트웨이 레벨에서 단위 시간당 허용되는 요청 횟수를 명확히 제한하는 기법이다.
<br>
<mark>고속도로 톨게이트 제한 속도</mark>처럼 도로가 감당할 수 있는 차량 수를 넘어서면 정체가 발생하듯이, 서버가 처리할 수 있는 속도를 제한하여 병목 현상을 방지한다.
<br>
주요 구현 알고리즘으로는 토큰 버킷과 리킷 버킷이 있다.
<br>

- <mark>토큰 버킷(Token Bucket)</mark> : 미리 정해진 양의 토큰(처리 권한)을 버킷에 채워두고, 요청이 올 때마다 토큰을 사용한다. 토큰이 없으면 요청은 거부되거나 대기열로 밀려나 시스템의 순간적인 부하를 제어한다.
- <mark>리키 버킷(Leaky Bucket)</mark> : 들어오는 요청의 유입량과 관계없이 일정한 속도로만 요청을 처리한다. 이는 시스템이 처리할 수 있는 최대 속도를 균일하게 유지하여 안정적인 서비스를 보장한다.

<br><br>

#### 1.2 Circuit Breaker(회로 차단기) - 장애 확산 방지
Rate Limiting이 외부 트래픽을 막는 방어라면, Circuit Breaker는 내부 시스템 장애가 다른 서비스로 전파되는 것을 차단한다.
<br>
<mark>가정집 누전 차단기</mark>처럼 특정 가전제품(=마이크로서비스)에 문제가 생겨 과부하가 걸리면, 누전 차단기가 전체 전력(=시스템)을 보호하기 위해 해당 회로를 차단한다.
<br>
원리를 살펴보면, 특정 서비스에 대한 요청 실패율이 일정 수준을 넘으면, 해당 서비스로의 요청을 일시적으로 중단하고 대신 '대체 응답(Fallback)'을 돌려준다. 문제가 해결된 것으로 판단될 때까지 차단 상태를 유지하여 시스템의 <mark>장애 도미노 현상</mark>을 막는다.

<br><br><br>

## 2. 트랜잭션의 생명줄 : 분산 환경에서의 ID 생성 전략
모든 거래와 데이터는 고유한 ID를 가져야 한다.
대규모 분산 환경에서는 이 ID를 겹치지 않게, 빠르게, 그리고 중앙 집중 없이 생성하는 것이 관건이다.

<br>

#### 2.1 기존 ID 전략의 한계

| ID방식 | 원리 | 대용량 환경의 한계 |
| --- | --- | --- |
| Sequence(DB Auto-Increment) | 1,2,3,... 순차 증가 | 모든 서버가 하나의 중앙 DB에 의존하여 병목 현상 발생 |
| GUID/UUID (랜덤) | 길고 복잡한 랜덤 문자열 | 순서가 없어서 DB 인덱싱 및 정렬 성능이 크게 저하됨 |

<br><br>

#### 2.2 Sequence 채굴 방식의 탄생
이 하이브리드 전략은 순번(Sequence)의 편리성과 분산처리(GUID)의 효율성을 결합한다.
<mark>번호표 묶음 배포</mark>처럼 은행 창구에서 순번표를 한 장씩 뽑는 대신, 각 창구(백엔드 서버)에 100장씩 묶음(ID블록)을 미리 배포한다.

<br>
기술적 구현 과정은 아래와 같다.

1. 중앙 ID 서버 (ID Generator): 트랜잭션을 처리하는 백엔드 서버에게 ID블록 (ex. 1000001~1001000)을 할당해주는 역할을 한다. 이 서버는 최소한의 동기화만 담당함
2. ID 블록 요청 및 캐싱 : 각 백엔드 서버는 시작시 또는 현재 할당된 ID블록을 모두 소진하기 전에, 중앙 ID서버에 다음 ID블록을 요청한다.
3. 독립적 사용 : 요청을 받은 백엔드 서버는 중앙 서버와 더 이상 통신할 필요 없이, 할당받은 블록 내에서 독립적으로, 순차적으로 ID를 부여한다.
4. 성능 최적화 : 중앙 서버와의 통신 횟수가 기획적으로 줄어들어 병목 현상이 해소되고, 각 서버는 빠르게 ID를 생성하며, 생성된 ID는 순차성을 띠어 DB 인덱스 성능에도 유리하다.

<br><br><br>

### 결론
대용량 프래픽을 처리하는 백엔드 시스템은 단순히 서버의 갯수만 무한대 늘릴 것이 아니라, 적절한 로직이 필요하다.
- <mark>방어(Defense)</mark> : Rate Limiting과 Circuit Breaker를 통해 서비스의 안정성을 확보하고 장애 확산을 방지한다.
- <mark>정렬(Order)</mark> : 시퀀스 채굴과 같은 분산ID전략을 통해 수많은 트랜잭션 속에서도 데이터의 고유성과 추적 가능성을 보장한다.